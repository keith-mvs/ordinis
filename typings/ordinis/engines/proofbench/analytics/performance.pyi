"""
This type stub file was generated by pyright.
"""

import pandas as pd
from dataclasses import dataclass
from typing import TYPE_CHECKING
from ..core.portfolio import Trade

"""Performance analytics for backtest results.

Provides comprehensive performance metrics including risk-adjusted returns,
drawdown analysis, and trade statistics.
"""
if TYPE_CHECKING:
    ...
@dataclass
class PerformanceMetrics:
    """Container for performance metrics.

    Attributes:
        # Returns
        total_return: Total return (%)
        annualized_return: Annualized return (%)

        # Risk metrics
        volatility: Annualized volatility (%)
        downside_deviation: Downside deviation (%)

        # Risk-adjusted metrics
        sharpe_ratio: Sharpe ratio
        sortino_ratio: Sortino ratio
        calmar_ratio: Calmar ratio

        # Drawdown metrics
        max_drawdown: Maximum drawdown (%)
        avg_drawdown: Average drawdown (%)
        max_drawdown_duration: Max drawdown duration (days)

        # Trade statistics
        num_trades: Number of trades
        win_rate: Win rate (%)
        profit_factor: Profit factor
        avg_win: Average win ($)
        avg_loss: Average loss ($)
        largest_win: Largest win ($)
        largest_loss: Largest loss ($)
        avg_trade_duration: Average trade duration (days)

        # Additional metrics
        expectancy: Expected value per trade
        recovery_factor: Recovery factor (total return / max drawdown)
        equity_final: Final equity value
    """
    total_return: float
    annualized_return: float
    volatility: float
    downside_deviation: float
    sharpe_ratio: float
    sortino_ratio: float
    calmar_ratio: float
    max_drawdown: float
    avg_drawdown: float
    max_drawdown_duration: float
    num_trades: int
    win_rate: float
    profit_factor: float
    avg_win: float
    avg_loss: float
    largest_win: float
    largest_loss: float
    avg_trade_duration: float
    expectancy: float
    recovery_factor: float
    equity_final: float
    ...


@dataclass
class BenchmarkMetrics:
    alpha: float
    beta: float
    correlation: float
    r_squared: float
    information_ratio: float
    treynor_ratio: float
    ...


class PerformanceAnalyzer:
    """Analyzes backtest performance and generates metrics.

    Calculates risk-adjusted returns, drawdown analysis, and trade statistics.
    """
    def __init__(self, risk_free_rate: float = ...) -> None:
        """Initialize performance analyzer.

        Args:
            risk_free_rate: Annual risk-free rate (default: 2%)
        """
        ...
    
    def analyze(self, equity_curve: list[tuple], trades: list[Trade], initial_capital: float) -> PerformanceMetrics:
        """Analyze backtest performance.

        Args:
            equity_curve: List of (timestamp, equity) tuples
            trades: List of completed trades
            initial_capital: Starting capital

        Returns:
            PerformanceMetrics object
        """
        ...
    


def compare_to_benchmark(strategy_returns: pd.Series, benchmark_returns: pd.Series, risk_free_rate: float = ...) -> BenchmarkMetrics:
    """Calculate benchmark-relative metrics (alpha, beta, info ratio, etc.)."""
    ...

