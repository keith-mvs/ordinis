"""
This type stub file was generated by pyright.
"""

import pandas as pd
from collections.abc import Callable
from dataclasses import dataclass
from datetime import datetime
from ..analytics.performance import PerformanceMetrics
from .execution import ExecutionConfig, Order
from .portfolio import Portfolio

"""Simulation engine for backtesting strategies.

Coordinates event-driven simulation with portfolio management,
execution simulation, and performance analytics.
"""
@dataclass
class SimulationConfig:
    """Configuration for simulation engine.

    Attributes:
        initial_capital: Starting capital
        execution_config: Execution simulator configuration
        bar_frequency: Bar frequency (e.g., '1min', '1h', '1d')
        record_equity_frequency: How often to record equity (bars)
        enable_logging: Enable detailed logging
        risk_free_rate: Annual risk-free rate for metrics
    """
    initial_capital: float = ...
    execution_config: ExecutionConfig = ...
    bar_frequency: str = ...
    record_equity_frequency: int = ...
    enable_logging: bool = ...
    risk_free_rate: float = ...
    def __post_init__(self): # -> None:
        """Validate configuration."""
        ...
    


@dataclass
class SimulationResults:
    """Results from a backtest simulation.

    Attributes:
        config: Simulation configuration used
        metrics: Performance metrics
        portfolio: Final portfolio state
        equity_curve: Equity curve data
        trades: List of all trades
        orders: List of all orders
        start_time: Simulation start time
        end_time: Simulation end time
    """
    config: SimulationConfig
    metrics: PerformanceMetrics
    portfolio: Portfolio
    equity_curve: pd.DataFrame
    trades: pd.DataFrame
    orders: list[Order]
    start_time: datetime
    end_time: datetime
    ...


class SimulationEngine:
    """Event-driven simulation engine for backtesting.

    Runs strategies through historical data with realistic execution modeling.
    Coordinates events, portfolio updates, and performance tracking.
    """
    def __init__(self, config: SimulationConfig | None = ...) -> None:
        """Initialize simulation engine.

        Args:
            config: Simulation configuration (uses defaults if None)
        """
        ...
    
    def load_data(self, symbol: str, data: pd.DataFrame): # -> None:
        """Load historical data for a symbol.

        Args:
            symbol: Stock symbol
            data: DataFrame with OHLCV columns and datetime index
        """
        ...
    
    def set_strategy(self, strategy_callback: Callable): # -> None:
        """Set strategy callback function.

        The callback is called on each bar with (engine, symbol, bar).
        It should submit orders using engine.submit_order().

        Args:
            strategy_callback: Function to call on each bar
        """
        ...
    
    def submit_order(self, order: Order): # -> None:
        """Submit an order for execution.

        Args:
            order: Order to submit
        """
        ...
    
    def run(self, start: datetime | None = ..., end: datetime | None = ...) -> SimulationResults:
        """Run the backtest simulation.

        Args:
            start: Start date (uses data start if None)
            end: End date (uses data end if None)

        Returns:
            SimulationResults object
        """
        ...
    
    def get_position(self, symbol: str): # -> Position | None:
        """Get current position for a symbol.

        Args:
            symbol: Stock symbol

        Returns:
            Position object or None
        """
        ...
    
    def get_cash(self) -> float:
        """Get current cash balance.

        Returns:
            Cash balance
        """
        ...
    
    def get_equity(self) -> float:
        """Get current total equity.

        Returns:
            Total equity
        """
        ...
    


