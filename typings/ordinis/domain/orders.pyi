"""
This type stub file was generated by pyright.
"""

from datetime import datetime
from typing import Any
from pydantic import BaseModel, model_validator
from ordinis.domain.enums import OrderSide, OrderStatus, OrderType, TimeInForce

"""
Order domain models.
"""
class Fill(BaseModel):
    """Execution fill record."""
    fill_id: str
    order_id: str
    symbol: str
    side: OrderSide
    quantity: int
    price: float
    commission: float = ...
    timestamp: datetime = ...
    latency_ms: float = ...
    slippage: float = ...
    slippage_bps: float = ...
    vs_arrival_bps: float = ...
    multiplier: float = ...
    metadata: dict[str, Any] = ...
    @property
    def total_cost(self) -> float:
        """Get total cost including commission."""
        ...
    
    @property
    def net_proceeds(self) -> float:
        """Get net proceeds (for sells) or net cost (for buys)."""
        ...
    


class ExecutionEvent(BaseModel):
    """Audit event for order lifecycle."""
    event_id: str
    order_id: str
    event_type: str
    timestamp: datetime = ...
    status_before: OrderStatus | None = ...
    status_after: OrderStatus
    details: dict[str, Any] = ...
    error_code: str | None = ...
    error_message: str | None = ...
    retry_count: int = ...


class Order(BaseModel):
    """
    Executable order with full lifecycle tracking.
    """
    order_id: str = ...
    client_order_id: str | None = ...
    broker_order_id: str | None = ...
    symbol: str
    side: OrderSide
    quantity: int = ...
    order_type: OrderType = ...
    time_in_force: TimeInForce = ...
    limit_price: float | None = ...
    stop_price: float | None = ...
    status: OrderStatus = ...
    filled_quantity: int = ...
    avg_fill_price: float = ...
    created_at: datetime = ...
    submitted_at: datetime | None = ...
    filled_at: datetime | None = ...
    updated_at: datetime | None = ...
    @property
    def timestamp(self) -> datetime:
        """Alias for created_at for backward compatibility."""
        ...
    
    intent_id: str | None = ...
    signal_id: str | None = ...
    strategy_id: str | None = ...
    fills: list[Fill] = ...
    events: list[ExecutionEvent] = ...
    broker_response: dict[str, Any] = ...
    error_message: str | None = ...
    retry_count: int = ...
    metadata: dict[str, Any] = ...
    @property
    def remaining_quantity(self) -> int:
        """Calculate remaining quantity."""
        ...
    
    @model_validator(mode="after")
    def validate_prices(self) -> Order:
        """Validate that required prices are present for specific order types."""
        ...
    
    def is_terminal(self) -> bool:
        """Check if order is in terminal state."""
        ...
    
    def is_active(self) -> bool:
        """Check if order is active (can still be filled)."""
        ...
    
    @property
    def is_filled(self) -> bool:
        """Check if order is completely filled."""
        ...
    
    @property
    def is_partial(self) -> bool:
        """Check if order is partially filled."""
        ...
    
    def fill_percentage(self) -> float:
        """Calculate fill percentage."""
        ...
    
    def add_fill(self, fill: Fill) -> None:
        """
        Add a fill to the order.
        Updates filled quantity and average fill price.
        """
        ...
    


